<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      textarea,
      .array {
        font-family: monospace;
        font-size: 1.5rem;
        background-color: Black;
        color: White;
      }
      .output {
        width: 40rem !important;
      }
      .count {
        font-family: monospace;
        background-color: Black;
        font-size: 1.2rem;
        color: White;
      }
      textarea,
      .array {
      }
    </style>
    <title>Quick sort</title>
  </head>
  <body>
    <div id="app">
      <div class="my-4">
        <div class="my-3 container">
          <h1>Quick sort</h1>
          <div class="array d-inline-block rounded">
            <p class="mb-0 px-2 py-1 mx-auto">{{array.join(', ')}}</p>
          </div>

          <div class="row mt-2 gx-2-0 align-items-center">
            <div class="col-auto">
              <button class="btn btn-success" type="button" @click="callQsort">
                Sort
              </button>
            </div>
            <div class="col-auto">
              <button class="btn btn-primary" type="button" @click="change">
                Refresh array
              </button>
            </div>
            <div class="col-auto">
              <p class="p-1 rounded count d-inline-block mb-0">
                Swaps: {{count}}
              </p>
            </div>
          </div>
          <div class="mt-2 array d-inline-block rounded p-1">
            <p class="mb-0 px-2 py-1 mx-auto output" v-html="output"></p>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      const { createApp } = Vue;
      const app = createApp({
        data() {
          return {
            array: [],
            output: '&nbsp;',
            count: 0,
          };
        },
        methods: {
          newArray: function (n = 15) {
            return Array(n)
              .fill()
              .reduce((acc, _) => {
                return [
                  ...acc,
                  String.fromCharCode(65 + Math.floor(Math.random() * 26)),
                ];
              }, []);
          },
          change: function () {
            this.array = this.newArray();
          },
          swap: function (arr, i, j) {
            this.count += 1;
            let temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
          },
          partition: function (arr, lo, hi) {
            // Choose middle element as pivot
            let pInd = Math.ceil((lo + hi) / 2);

            // Median optimisation
            if (arr[pInd] < arr[lo]) {
              this.swap(arr, pInd, lo);
            }
            if (arr[hi] < arr[lo]) {
              this.swap(arr, hi, lo);
            }
            if (arr[pInd] < arr[hi]) {
              this.swap(arr, pInd, hi);
            }

            let pivot = arr[pInd];
            // Keep track of equal values
            let eq = lo;
            let l = lo;
            let r = hi;
            while (eq <= r) {
              if (arr[eq] < pivot) {
                this.swap(arr, eq, l);
                l += 1;
                eq += 1;
              } else if (arr[eq] > pivot) {
                this.swap(arr, eq, r);
                r -= 1;
              } else {
                eq += 1;
              }
            }
            return { l, r };
          },
          callQsort: function () {
            this.count = 0;
            this.output = '';
            let arr = [...this.array];
            this.qsort(arr, 0, arr.length - 1);
            this.output += `${arr.join(', ')}`;
          },
          qsort: function (arr, lo, hi) {
            if (lo >= 0 && lo < hi) {
              let { l, r } = this.partition(arr, lo, hi);
              this.qsort(arr, lo, l - 1);
              this.qsort(arr, r + 1, hi);
            }
          },
        },
        mounted() {
          this.change();
        },
      }).mount('#app');
    </script>
  </body>
</html>
